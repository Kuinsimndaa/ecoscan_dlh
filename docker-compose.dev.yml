version: '3.8'

# Development overrides for local testing
# Usage: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  mysql:
    ports:
      - "3306:3306" # Expose MySQL publicly for local dev tools
    environment:
      MYSQL_ROOT_PASSWORD: root # Simple password for dev

  backend:
    build:
      context: ./backend
      target: base # Use base stage if multi-stage
    environment:
      NODE_ENV: development
    ports:
      - "3030:3030" # Expose backend publicly for local testing
    volumes:
      - ./backend:/app # Hot reload support
      - /app/node_modules # Preserve node_modules in container
    command: npm run dev # Use dev script if available

  frontend:
    build:
      context: ./frontend
      target: builder # Use builder stage for dev server
      args:
        VITE_API_BASE_URL: http://localhost:3030
    environment:
      NODE_ENV: development
    ports:
      - "5050:5050" # Vite dev server port
    volumes:
      - ./frontend:/app
      - /app/node_modules
    command: npm run dev -- --host 0.0.0.0 --port 5050
    depends_on:
      - backend

# Development notes:
# - All ports exposed for easier debugging
# - Volume mounts enable hot reload
# - Simplified passwords for convenience
# - Frontend runs Vite dev server instead of nginx
